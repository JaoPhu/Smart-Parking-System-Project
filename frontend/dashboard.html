<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg-gray-100 text-gray-800 p-4 min-h-screen flex flex-col items-center">
  <main class="container mx-auto max-w-screen-lg py-8">
    <h1 class="text-4xl font-extrabold mb-4 text-center text-indigo-700">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h1>
    <p class="text-lg text-center mb-6 text-gray-600">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•: <span id="admin-name" class="font-semibold text-indigo-600"></span></p>
    
    <div class="flex justify-center mb-6">
      <button onclick="resetSlots()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition duration-200">
        üßº ‡∏£‡∏µ‡πÄ‡∏ã‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î
      </button>
    </div>
    <div id="reset-status" class="mt-4 text-center text-sm font-medium text-green-600"></div>

    <hr class="my-8 border-gray-300">

    <h2 class="text-2xl font-bold mb-4 text-gray-800">üöó ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <div id="slots-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-items-center">
      </div>
  </main>
  
  <script>
    // Script to display admin name
    document.addEventListener("DOMContentLoaded", () => {
        const adminNameSpan = document.getElementById("admin-name");
        const username = localStorage.getItem("username");
        if (username) {
            adminNameSpan.textContent = username;
        } else {
            adminNameSpan.textContent = "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"; // Fallback if no username found
            // Optional: Redirect to login page if not logged in
            // window.location.href = "login.html";
        }
    });

    // Function to reset slots (admin privilege)
    async function resetSlots() {
      const resetStatusDiv = document.getElementById("reset-status");
      resetStatusDiv.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
      resetStatusDiv.classList.remove("text-green-600", "text-red-600");
      resetStatusDiv.classList.add("text-blue-600");

      try {
        const role = localStorage.getItem("role");
        if (role !== "admin") {
            resetStatusDiv.textContent = "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚ùå";
            resetStatusDiv.classList.remove("text-blue-600");
            resetStatusDiv.classList.add("text-red-600");
            return;
        }

        const res = await fetch("http://localhost:5000/api/slots/reset", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-role": role // Assuming your API uses x-role header for authorization
          }
        });
        const result = await res.json();
        
        if (res.ok) {
            resetStatusDiv.textContent = result.message || "‡∏£‡∏µ‡πÄ‡∏ã‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ";
            resetStatusDiv.classList.remove("text-blue-600");
            resetStatusDiv.classList.add("text-green-600");
            // After reset, refresh the slots display
            if (typeof fetchAndRenderSlots === 'function') {
              fetchAndRenderSlots();
            } else {
              console.warn("fetchAndRenderSlots function not found. Please ensure script.js is loaded and properly defines it.");
              // Fallback if script.js isn't loaded correctly for some reason
              location.reload(); 
            }
        } else {
            resetStatusDiv.textContent = result.error || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÄ‡∏ã‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‚ùå";
            resetStatusDiv.classList.remove("text-blue-600");
            resetStatusDiv.classList.add("text-red-600");
        }
      } catch (error) {
        console.error("Error resetting slots:", error);
        resetStatusDiv.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‚ùå";
        resetStatusDiv.classList.remove("text-blue-600");
        resetStatusDiv.classList.add("text-red-600");
      }
    }
  </script>
  <script src="script.js"></script>
</body>
</html>